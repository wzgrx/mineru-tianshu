# ============================================================================
# Tianshu (天枢) - 环境变量配置 (RTX 5090 优化版)
# ============================================================================
#
# 使用方式：
#   1. 保存此内容为 .env
#   2. 使用 docker-compose up -d 启动服务
#
# ============================================================================

# ----------------------------------------------------------------------------
# [新增] 模型挂载路径配置 (关键修改)
# ----------------------------------------------------------------------------
# 注意：在 WSL2 中，Windows 的 D: 盘路径为 /mnt/d/
# 请确保这些文件夹在您的 Windows 系统中真实存在，否则 Docker 会自动创建空文件夹。

# PaddleX 模型 (您指定的路径: D:\aiworkspace\models\paddlex)
MODEL_DIR_PADDLEX=/mnt/d/aiworkspace/models/paddlex

# MinerU 模型 (假设在 D:\aiworkspace\models\mineru)
MODEL_DIR_MINERU=/mnt/d/aiworkspace/models/mineru

# PaddleOCR 模型 (假设在 D:\aiworkspace\models\paddleocr)
MODEL_DIR_PADDLEOCR=/mnt/d/aiworkspace/models/paddleocr

# HuggingFace 缓存 (假设在 D:\aiworkspace\models\huggingface)
MODEL_DIR_HF=/mnt/d/aiworkspace/models/huggingface

# ModelScope 缓存 (假设在 D:\aiworkspace\models\modelscope)
MODEL_DIR_MS=/mnt/d/aiworkspace/models/modelscope

# ----------------------------------------------------------------------------
# 应用配置
# ----------------------------------------------------------------------------
API_PORT=8000
WORKER_PORT=8001
MCP_PORT=8002
FRONTEND_PORT=80

LOG_LEVEL=INFO

# ----------------------------------------------------------------------------
# JWT 认证配置
# ----------------------------------------------------------------------------
# 重要：生产环境请修改为随机字符串！
# 生成方式: openssl rand -hex 32
JWT_SECRET_KEY=tianshu-secret-key-rtx5090-dev-change-me
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# ----------------------------------------------------------------------------
# CORS 配置
# ----------------------------------------------------------------------------
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:80

# ----------------------------------------------------------------------------
# GPU 配置 (RTX 5090 优化)
# ----------------------------------------------------------------------------
# GPU 数量（Docker 分配）
GPU_COUNT=1

# 可见的 GPU 设备（Backend，逗号分隔）
CUDA_VISIBLE_DEVICES=0

# 每个 GPU 的 Worker 数量
# 5090 显存虽然大，但 vLLM 会占用大部分。建议设为 1，避免 OOM。
WORKER_GPUS=1

# Worker 批处理大小
MAX_BATCH_SIZE=4

# Worker 超时时间（秒）
WORKER_TIMEOUT=300

# Worker 内存限制（硬限制）
# 您有 192GB 内存，给 Worker 分配 32GB 绰绰有余，处理超大 PDF 更稳。
WORKER_MEMORY_LIMIT=32G

# Worker 内存软限制（保证最少可用内存）
WORKER_MEMORY_RESERVATION=16G

# ----------------------------------------------------------------------------
# 文件配置
# ----------------------------------------------------------------------------
# 最大文件大小（字节，0 表示不限制）
MAX_FILE_SIZE=0

# Nginx 文件上传大小限制（0 表示不限制）
NGINX_CLIENT_MAX_BODY_SIZE=0

# ----------------------------------------------------------------------------
# PDF 拆分配置（大文件并行处理）
# ----------------------------------------------------------------------------
# 是否启用 PDF 自动拆分（true/false）
PDF_SPLIT_ENABLED=true

# PDF 拆分阈值（页数）
# 超过此页数的 PDF 会自动拆分为多个子任务并行处理
PDF_SPLIT_THRESHOLD_PAGES=500

# PDF 拆分块大小（页数）
PDF_SPLIT_CHUNK_SIZE=250

# ----------------------------------------------------------------------------
# 数据库配置
# ----------------------------------------------------------------------------
DATABASE_PATH=/app/data/db/mineru_tianshu.db

# ----------------------------------------------------------------------------
# 模型下载配置
# ----------------------------------------------------------------------------
# 模型下载源: modelscope（国内推荐）
MODEL_DOWNLOAD_SOURCE=modelscope

# HuggingFace 镜像地址（国内加速）
HF_ENDPOINT=https://hf-mirror.com

# 离线模型外部目录
OFFLINE_MODELS_PATH=./models-offline

# ----------------------------------------------------------------------------
# RustFS 对象存储配置
# ----------------------------------------------------------------------------
# 启用 RustFS（建议开启以获得更好性能）
RUSTFS_ENABLED=true

# RustFS 服务地址（容器内部）
RUSTFS_ENDPOINT=rustfs:9000

# RustFS 访问密钥
RUSTFS_ACCESS_KEY=rustfsadmin
RUSTFS_SECRET_KEY=rustfsadmin

# RustFS 存储桶名称
RUSTFS_BUCKET=ts-img

# RustFS 是否使用 HTTPS
RUSTFS_SECURE=false

# RustFS 公开访问 URL（外部访问地址）
# Win11 WSL2 开启镜像网络模式后，localhost 通常可直接互通。
# 如果局域网其他机器无法加载图片，请将 localhost 改为您的局域网 IP (如 192.168.x.x)
RUSTFS_PUBLIC_URL=http://localhost:9000

# RustFS 服务端口
RUSTFS_PORT=9000
RUSTFS_CONSOLE_PORT=9001

# ----------------------------------------------------------------------------
# MCP Server 配置
# ----------------------------------------------------------------------------
API_URL=http://backend:8000

# ----------------------------------------------------------------------------
# Redis 队列配置
# ----------------------------------------------------------------------------
# 启用 Redis 队列（强烈推荐开启，解决 SQLite 并发锁死问题）
REDIS_QUEUE_ENABLED=true

# Redis 服务器配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ----------------------------------------------------------------------------
# 前端配置
# ----------------------------------------------------------------------------
# 如果只是本机访问，localhost 即可。
# 如果局域网访问，请改为局域网 IP。
VITE_API_BASE_URL=http://localhost:8000
